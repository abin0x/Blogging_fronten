<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶ï‡¶æ‡¶õ‡ßá‡¶∞ ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 500px;
            width: 100%;
        }
        button {
            padding: 10px;
            background: green;
            color: white;
            border: none;
            cursor: pointer;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <h2>üïå ‡¶ï‡¶æ‡¶õ‡ßá‡¶∞ ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</h2>
    <button onclick="getUserLocation()">üìç ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶®‡¶ø‡¶®</button>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        let map = L.map('map').setView([23.8103, 90.4125], 13); // Default Dhaka, Bangladesh
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        let userMarker;
        let nearestMosque = null;
        let minDistance = Infinity;

        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    let lat = position.coords.latitude;
                    let lon = position.coords.longitude;
                    map.setView([lat, lon], 14);

                    if (userMarker) map.removeLayer(userMarker);
                    
                    userMarker = L.marker([lat, lon]).addTo(map)
                        .bindPopup("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® üìç")
                        .openPopup();

                    findNearbyMosques(lat, lon);
                });
            } else {
                alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ!");
            }
        }

        function findNearbyMosques(lat, lon) {
            let radius = 5000; // ‡ß´ ‡¶ï‡¶ø‡¶≤‡ßã‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶∏‡¶æ‡¶∞‡ßç‡¶ß
            let overpassUrl = `https://overpass-api.de/api/interpreter?data=[out:json];node(around:${radius},${lat},${lon})[amenity=place_of_worship];out;`;

            fetch(overpassUrl)
                .then(response => response.json())
                .then(data => {
                    minDistance = Infinity; // Reset nearest distance
                    nearestMosque = null; // Reset nearest mosque
                    
                    data.elements.forEach(mosque => {
                        let mosqueLat = mosque.lat;
                        let mosqueLon = mosque.lon;
                        let mosqueName = mosque.tags.name || "‡¶®‡¶æ‡¶Æ ‡¶®‡ßá‡¶á üïå";

                        let distance = getDistanceFromLatLonInKm(lat, lon, mosqueLat, mosqueLon);
                        distance = distance.toFixed(2); // ‡¶¶‡ßÅ‡¶á ‡¶¶‡¶∂‡¶Æ‡¶ø‡¶ï ‡¶ò‡¶∞ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá

                        let marker = L.marker([mosqueLat, mosqueLon]).addTo(map)
                            .bindPopup(`
                                <b>${mosqueName}</b> <br>
                                üìç ‡¶¶‡ßÇ‡¶∞‡¶§‡ßç‡¶¨: ${distance} ‡¶ï‡¶ø‡¶Æ‡¶ø <br>
                                <a href="https://www.google.com/maps/dir/?api=1&destination=${mosqueLat},${mosqueLon}" target="_blank">üöó ‡¶¶‡¶ø‡¶ï‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶®‡¶æ ‡¶®‡¶ø‡¶®</a>
                            `);

                        if (distance < minDistance) {
                            minDistance = distance;
                            nearestMosque = { lat: mosqueLat, lon: mosqueLon, name: mosqueName };
                        }
                    });

                    // Nearest Mosque Highlight
                    if (nearestMosque) {
                        L.marker([nearestMosque.lat, nearestMosque.lon], { color: 'red' }).addTo(map)
                            .bindPopup(`<b>üìç ‡¶ï‡¶æ‡¶õ‡ßá‡¶∞ ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶: ${nearestMosque.name}</b> <br> ‡¶¶‡ßÇ‡¶∞‡¶§‡ßç‡¶¨: ${minDistance} ‡¶ï‡¶ø‡¶Æ‡¶ø`);
                    }
                })
                .catch(error => console.error("‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç‡ßü‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:", error));
        }

        function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
            var R = 6371; // ‡¶™‡ßÉ‡¶•‡¶ø‡¶¨‡ßÄ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶∏‡¶æ‡¶∞‡ßç‡¶ß (‡¶ï‡¶ø‡¶Æ‡¶ø)
            var dLat = deg2rad(lat2 - lat1);
            var dLon = deg2rad(lon2 - lon1);
            var a = 
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            var distance = R * c;
            return distance;
        }

        function deg2rad(deg) {
            return deg * (Math.PI / 180);
        }
    </script>

</body>
</html>
<!-- j  -->