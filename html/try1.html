<!DOCTYPE html>
<html>
<head>
    <title>Quran Reader</title>
    <style>
        /*... (styles from previous response)... */
        #ayahContainer {
            /*... (grid styles from previous response)... */
            counter-reset: ayah-counter; /* Initialize ayah counter */
        }
      .ayahDiv {
            /*... (ayah div styles from previous response)... */
            position: relative; /* For positioning the ayah number */
        }
      .ayahDiv::before { /* Add ayah number before the text */
            content: counter(ayah-counter) ".";
            counter-increment: ayah-counter; /* Increment counter */
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 16px;
            color: #777;
        }

        /* Style for the audio controls at the bottom */
        #audio-controls {
            margin-top: 20px;
            text-align: center; /* Center the controls */
        }
        #main-audio {
            width: 80%; /* Adjust width as needed */
            max-width: 600px;
        }

      .playing { /* Style for the currently playing ayah */
            background-color: #e0f2f7; /* Light blue highlight */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Quran Reader</h1>
        <select id="surahSelect">
            <option value="">Select a Surah</option>
        </select>
        <div id="ayahContainer"></div>

        <div id="audio-controls">
            <audio id="main-audio" controls></audio>
        </div>

    </div>

    <script>
        const surahSelect = document.getElementById('surahSelect');
        const ayahContainer = document.getElementById('ayahContainer');
        const mainAudio = document.getElementById('main-audio'); // Get the main audio element

        fetch('https://api.alquran.cloud/v1/quran/ar.alafasy')
          .then(response => response.json())
          .then(data => {
                //... (Surah select population from previous response)...

                surahSelect.addEventListener('change', () => {
                    const selectedSurah = surahSelect.value;
                    ayahContainer.innerHTML = '';
                    mainAudio.src = ""; // Clear main audio source

                    const selectedSurahData = data.data.surahs.find(surah => surah.number == selectedSurah);
                    if (!selectedSurahData) return; // Handle if surah data is not found.

                    let currentAyahIndex = 0; // Keep track of the current ayah

                    selectedSurahData.ayahs.forEach((ayah, index) => {
                        const ayahDiv = document.createElement('div');
                        ayahDiv.classList.add('ayahDiv');

                        ayahDiv.innerHTML = `
                            <p>${ayah.text}</p>
                        `;
                        ayahContainer.appendChild(ayahDiv);

                        if (index === 0) { // Play the first ayah automatically
                            playAyah(ayah, ayahDiv);
                        }
                    });

                    function playAyah(ayah, ayahDiv) {
                        mainAudio.src = ayah.audio;
                        mainAudio.play();

                        // Highlight the currently playing ayah
                        const allAyahDivs = ayahContainer.querySelectorAll('.ayahDiv');
                        allAyahDivs.forEach(div => div.classList.remove('playing')); // Remove previous highlights
                        ayahDiv.classList.add('playing'); // Highlight the current ayah

                        mainAudio.addEventListener('ended', () => {
                            currentAyahIndex++;
                            if (currentAyahIndex < selectedSurahData.ayahs.length) {
                                const nextAyah = selectedSurahData.ayahs[currentAyahIndex];
                                const nextAyahDiv = ayahContainer.querySelectorAll('.ayahDiv')[currentAyahIndex];
                                playAyah(nextAyah, nextAyahDiv);
                            }
                        });
                    }
                });
            });
    </script>
</body>
</html>